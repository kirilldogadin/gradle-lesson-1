# Приключения в мире сборки: Первое знакомство с Gradle

## Эпизод 1: Потерянный в лабиринте зависимостей

*Основано на драматической ситуации "Поиск" из 36 сюжетов Жоржа Польти*

### Пролог: Зов приключений

Джек Билдер был обычным разработчиком в компании "Монолит Софтвер". Каждый день он писал код, компилировал его вручную и собирал проекты, используя самописные скрипты. Жизнь текла размеренно и предсказуемо, пока однажды...

"Джек, нам нужно срочно перейти на новую систему сборки! Клиент требует, чтобы проект был готов через неделю, а наши скрипты не справляются," — голос технического директора Алекса звучал встревоженно.

"Какую систему?" — спросил Джек, не отрывая взгляда от монитора.

"Gradle. Говорят, она гибкая и мощная. Разберись с ней к завтрашнему дню и подготовь презентацию для команды."

Джек вздохнул. Он слышал о Gradle, но никогда с ней не работал. Перед ним стояла непростая задача — освоить новый инструмент за один день и научить других. Это было начало его приключения в мире современных систем сборки.

### Акт 1: Встреча с наставником

Джек решил обратиться за помощью к Майе, опытному DevOps-инженеру из соседнего отдела.

"Gradle? Отличный выбор!" — улыбнулась Майя. — "Это не просто система сборки, это целая философия."

"Философия? Мне нужно просто собрать проект," — недоумевал Джек.

"В том-то и дело. Старые системы сборки говорят тебе *как* делать. Gradle спрашивает *что* ты хочешь сделать, а затем сам решает, как это лучше выполнить."

Майя открыла свой ноутбук и показала Джеку простой файл `build.gradle`:

```groovy
plugins {
    id 'java'
    id 'application'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'com.google.guava:guava:31.1-jre'
    testImplementation 'junit:junit:4.13.2'
}

application {
    mainClass = 'com.example.App'
}
```

"Видишь? Всего несколько строк, и Gradle уже знает, что это Java-проект, где искать зависимости, какие библиотеки нужны и какой класс запускать."

"Выглядит... лаконично," — признал Джек. — "А как это работает?"

### Акт 2: Погружение в неизведанное

Майя улыбнулась. "Давай я покажу тебе, как создать простой проект с нуля."

Она открыла терминал и ввела команду:

```bash
mkdir gradle-demo
cd gradle-demo
gradle init --type java-application
```

"Gradle использует систему плагинов," — объяснила Майя, пока терминал выполнял команду. — "Плагины добавляют функциональность. Например, плагин 'java' добавляет всё необходимое для компиляции Java-кода, а 'application' позволяет запускать приложение."

Джек внимательно наблюдал, как Gradle создавал структуру проекта:

```
gradle-demo/
├── app/
│   ├── build.gradle
│   └── src/
│       ├── main/
│       │   └── java/
│       └── test/
│           └── java/
├── gradle/
│   └── wrapper/
├── gradlew
├── gradlew.bat
└── settings.gradle
```

"А что такое этот wrapper?" — спросил Джек, указывая на файлы `gradlew` и `gradlew.bat`.

"О, это одна из самых полезных вещей в Gradle," — оживилась Майя. — "Gradle Wrapper — это скрипт, который позволяет запускать Gradle без предварительной установки. Он автоматически скачивает нужную версию Gradle и использует её для сборки проекта."

"То есть, другим разработчикам не нужно устанавливать Gradle?"

"Именно! Достаточно клонировать репозиторий и запустить `./gradlew build`. Wrapper гарантирует, что все используют одну и ту же версию Gradle."

Джек задумался. "Это решает проблему 'у меня работает, а у тебя нет'..."

### Акт 3: Испытание

Вдохновленный новыми знаниями, Джек вернулся к своему рабочему месту и решил применить Gradle к реальному проекту. Он создал новый проект и начал писать `build.gradle`.

```groovy
plugins {
    id 'java'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.apache.commons:commons-lang3:3.12.0'
    testImplementation 'junit:junit:4.13.2'
}
```

Джек запустил сборку:

```bash
./gradlew build
```

К его удивлению, Gradle автоматически скачал все зависимости, скомпилировал код и запустил тесты. "Это было... легко," — пробормотал он.

Но настоящие проблемы начались, когда Джек попытался интегрировать Gradle в существующий проект компании. Проект использовал нестандартную структуру, имел сложные зависимости и требовал специальных шагов при сборке.

Джек провел несколько часов, пытаясь настроить Gradle, но постоянно сталкивался с ошибками. Отчаявшись, он вернулся к Майе.

"Я не могу заставить это работать с нашим проектом," — признался он. — "Может, Gradle не так уж и хорош."

Майя улыбнулась. "Gradle — это не просто набор команд, это язык программирования. Ты можешь настроить его под любой проект, если знаешь, как."

### Акт 4: Откровение

Майя показала Джеку, как создавать собственные задачи в Gradle:

```groovy
task prepareEnvironment {
    description 'Prepares the environment for build'
    group 'Custom'
    
    doLast {
        println "Preparing environment..."
        // Здесь может быть любой код на Groovy
    }
}
```

"Видишь? Ты можешь создавать собственные задачи, которые будут выполнять любые действия. Gradle использует Groovy — полноценный язык программирования."

Джек начал понимать. "То есть, я могу написать код, который будет адаптировать Gradle под нашу нестандартную структуру?"

"Именно! И не только это. Ты можешь создавать зависимости между задачами, условно выполнять шаги сборки, генерировать код, запускать внешние процессы — всё, что нужно для твоего проекта."

Майя показала еще несколько примеров:

```groovy
// Зависимости между задачами
task taskA {
    doLast {
        println "Task A"
    }
}

task taskB {
    dependsOn taskA
    doLast {
        println "Task B"
    }
}

// Условное выполнение
task conditionalTask {
    doLast {
        if (project.hasProperty('debug')) {
            println "Debug mode enabled"
        }
    }
}
```

Джек был впечатлен. "Это действительно мощно. Но как Gradle управляет зависимостями? В нашем проекте их десятки."

Майя объяснила концепцию управления зависимостями в Gradle:

```groovy
dependencies {
    // Для компиляции и выполнения
    implementation 'com.google.guava:guava:31.1-jre'
    
    // Только для компиляции
    compileOnly 'org.projectlombok:lombok:1.18.24'
    
    // Только для выполнения
    runtimeOnly 'org.slf4j:slf4j-simple:2.0.5'
    
    // Для тестов
    testImplementation 'junit:junit:4.13.2'
}
```

"Gradle автоматически разрешает транзитивные зависимости и конфликты версий. Ты можешь управлять этим процессом, исключая ненужные зависимости или принудительно выбирая определенные версии."

### Акт 5: Возвращение с эликсиром

Вооруженный новыми знаниями, Джек вернулся к своему проекту. Он переписал `build.gradle`, создал собственные задачи для нестандартных шагов сборки и настроил управление зависимостями.

На следующий день Джек представил свою работу команде:

"Gradle — это не просто система сборки, это инструмент автоматизации, который может адаптироваться под любые нужды. Он объединяет лучшие практики из других систем и добавляет программируемость."

Джек продемонстрировал, как Gradle автоматически скачивает зависимости, компилирует код, запускает тесты и создает исполняемые файлы — всё одной командой.

"Но самое главное — Gradle делает сборку проекта воспроизводимой. Благодаря Wrapper, любой разработчик может собрать проект одной командой, без предварительной настройки."

Команда была впечатлена. Технический директор Алекс подошел к Джеку после презентации:

"Отличная работа! Я знал, что ты справишься. Теперь у нас есть неделя, чтобы перевести весь проект на Gradle."

Джек улыбнулся. Теперь он знал, что это возможно.

### Эпилог: Новые горизонты

Прошло несколько месяцев. Проект был успешно переведен на Gradle, сборка ускорилась в несколько раз, а новые разработчики могли начать работу с проектом за минуты, а не дни.

Джек стал экспертом по Gradle в компании. Он создал набор плагинов и скриптов, которые использовались во всех проектах "Монолит Софтвер".

"Знаешь," — сказал он Майе, встретив её в кафетерии, — "я никогда не думал, что система сборки может так изменить процесс разработки."

Майя улыбнулась. "Это только начало. В следующий раз я расскажу тебе о Groovy DSL и DelegatingScript..."

*Продолжение следует в Эпизоде 2: "Тайны Groovy DSL"*

## Технический справочник

### Основные понятия Gradle

- **Система сборки** — инструмент для автоматизации процесса создания исполняемого приложения
- **Gradle** — современная система сборки, использующая Groovy или Kotlin DSL
- **Плагины** — расширения, добавляющие функциональность в Gradle
- **Задачи (Tasks)** — единицы работы в Gradle
- **Gradle Wrapper** — скрипт для запуска Gradle без предварительной установки

### Структура проекта Gradle

```
project-root/
├── build.gradle        # Скрипт сборки
├── settings.gradle     # Настройки проекта
├── gradle/             # Директория для Gradle Wrapper
├── gradlew             # Скрипт Gradle Wrapper для Unix
├── gradlew.bat         # Скрипт Gradle Wrapper для Windows
├── src/                # Исходный код
│   ├── main/           # Основной код
│   └── test/           # Тестовый код
└── build/              # Директория для сборки
```

### Основные команды Gradle

- `gradle init` — инициализация нового проекта
- `./gradlew build` — сборка проекта
- `./gradlew clean` — очистка директории сборки
- `./gradlew test` — запуск тестов
- `./gradlew run` — запуск приложения
- `./gradlew tasks` — список доступных задач

### Управление зависимостями

```groovy
dependencies {
    implementation 'group:name:version'
    compileOnly 'group:name:version'
    runtimeOnly 'group:name:version'
    testImplementation 'group:name:version'
}
```

### Создание собственных задач

```groovy
task myTask {
    description 'Description of the task'
    group 'Custom'
    
    doLast {
        println "Task executed"
    }
}
```

### Зависимости между задачами

```groovy
task taskA {
    doLast {
        println "Task A"
    }
}

task taskB {
    dependsOn taskA
    doLast {
        println "Task B"
    }
}
```

### Лучшие практики

1. Всегда используйте Gradle Wrapper
2. Следуйте конвенциям структуры проекта
3. Используйте правильные конфигурации зависимостей
4. Документируйте задачи и скрипты
5. Оптимизируйте сборки с помощью кэширования и параллельного выполнения

## Упражнения для закрепления

1. Создайте простой Java-проект с Gradle
2. Добавьте зависимости и напишите код, использующий их
3. Создайте собственную задачу, которая выводит информацию о проекте
4. Настройте Gradle Wrapper для проекта
5. Изучите структуру файла build.gradle и попробуйте модифицировать его

## Вопросы для размышления

1. Чем Gradle отличается от других систем сборки?
2. Какие преимущества даёт программируемый подход к конфигурации сборки?
3. Почему Gradle Wrapper считается лучшей практикой?
4. Как Gradle управляет зависимостями и разрешает конфликты версий?
5. Какие задачи автоматизации, кроме сборки, можно решать с помощью Gradle?

*В следующем эпизоде: Джек погружается в мир Groovy DSL и узнаёт, как создавать гибкие и мощные скрипты сборки. Не пропустите "Тайны Groovy DSL"!*
